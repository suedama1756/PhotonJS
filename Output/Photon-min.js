(function(x){(function(b){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?b(module.exports||exports):"function"===typeof define&&define.amd?define(["exports","jquery"],b):(x.photon=x.photon||{},b(x.photon,x.$))})(function(b,k){function x(a,c,b,e,f,g,h){for(;c<b&&f<g&&h(a.data[c],e.data[f]);)c++,f++;for(;c<b&&f<g&&h(a.data[b-1],e.data[g-1]);)--b,--g;if(c===b)for(;f<g;)e.modified[f++]=!0;else if(f===g)for(;c<b;)a.modified[c++]=!0;else{var i;a:{i=c;var j=b,w=f,A=g,k=
{},n=a.length+e.length+1,v=i-w,p=j-A,s=0!==(j-i-(A-w)&1),l=Array(2*n+2),o=Array(2*n+2),u=n-v,n=n-p,z=(j-i+A-w)/2+1;l[u+v+1]=i;o[n+p-1]=j;for(var q,y,t=0;t<=z;t++){for(var m=v-t;m<=v+t;m+=2){m===v-t?q=l[u+m+1]:(q=l[u+m-1]+1,m<v+t&&l[u+m+1]>=q&&(q=l[u+m+1]));for(y=q-m;q<j&&y<A&&h(a.data[q],e.data[y]);)q++,y++;l[u+m]=q;if(s&&p-t<m&&m<p+t&&o[n+m]<=l[u+m]){k.x=l[u+m];k.y=l[u+m]-m;i=k;break a}}for(m=p-t;m<=p+t;m+=2){m===p+t?q=o[n+m-1]:(q=o[n+m+1]-1,m>p-t&&o[n+m-1]<q&&(q=o[n+m-1]));for(y=q-m;q>i&&y>w&&h(a.data[q-
1],e.data[y-1]);)q--,y--;o[n+m]=q;if(!s&&v-t<=m&&m<=v+t&&o[n+m]<=l[u+m]){k.x=l[u+m];k.y=l[u+m]-m;i=k;break a}}}r(!1);i=void 0}x(a,c,i.x,e,f,i.y,h);x(a,i.x,b,e,i.y,g,h)}}function N(a,c){for(var b=[],e,f,g=0,h=0,i=a.length,j=c.length;g<i||h<j;)if(g<i&&!a.modified[g]&&h<j&&!c.modified[h])g++,h++;else{e=g;for(f=h;g<i&&(h>=j||a.modified[g]);)g++;for(;h<j&&(g>=i||c.modified[h]);)h++;(e<g||f<h)&&b.push({startA:e,startB:f,deletedA:g-e,insertedB:h-f})}return b}function O(a){return a.replace(/(&quot;|&lt;|&gt;|&amp;)/g,
function(a,b){return P[b]})}function Q(a){return this===a||a.flowTemplate_}function G(a,c,d){d=c===d?null:(d=b.dom.findParent(c,Q,d))?d.flowTemplate_:null;d=new b.templating.FlowTemplate(d);d.getParent()||a.push(d);d.element_=c;c.flowTemplate_=d;c.setAttribute("data-template-id",d.getKey())}function H(a){var c=a.element_;if(c){var d=a.children_;if(d)for(var e=0,f=d.length;e<f;e++)H(d[e]);a.setTemplate(c.innerHTML);b.dom.empty(c);delete a.element_}}function I(a,c,d){k(b.string.trim(d)).appendTo(a).each(function(a,
d){1===d.nodeType&&b.binding.applyBindings(c,d)})}function J(a,c,d){b.isString(d)?I(a,c,d):b.templating.getHtml(d,function(b){I(a,c,b.template)})}defineNamespace=function(a,c){for(var d=a.split("."),e=b,f=0,g=d.length;f<g;f++)e=e[d[f]]=e[d[f]]||{};return b.extend(e,c)};provide=function(a,c){var d=a.split(".");if("photon"!==d[0])throw Error();for(var e=b,f=1,g=d.length;f<g;f++)e=e[d[f]]=e[d[f]]||{};return b.extend(e,c)};b.provide=provide;(function(){function a(a,c){return function(){var b=this.superType;
this.superType=c;try{return a.apply(this,arguments)}finally{this.superType=b}}}var c=/xyz/.test(function(){})?/\bsuperType\b/:/.*/;b.defineType=function(d,e,f,g){function h(){}b.isFunction(e)||(g=f,f=e,e=null);var i=null;e&&(i=e.prototype,h.prototype=i);d.prototype=new h;d.prototype.constructor=d;d.superType=i;d.base=function(a){i&&d.superType.constructor.apply(a,l.slice.call(arguments,1))};f&&b.extend(d.prototype,f,b.extend.filterHasOwnProperty,function(d,g){var f=d[g];return e&&b.isFunction(f)&&
c.test(f)?a(f,i):f});g&&b.extend(d,g);return d}})();var D=Object.prototype,z=String.prototype,l=Array.prototype;b.isUndefined=function(a){return void 0===a};b.isNullOrUndefined=function(a){return null===a||b.isUndefined(a)};b.isString=function(a){return"string"===typeof a};b.isElement=function(a){return a&&1===a.nodeType};b.isDocument=function(a){return a&&9===a.nodeType};b.isDocumentOrElement=function(a){return a&&(1===a.nodeType||9===a.nodeType)};b.isDocumentFragment=function(a){return a&&11===
a.nodeType};b.isFunction=function(a){return"function"===typeof a};b.isArray=function(a){return"[object Array]"===D.toString.call(a)};b.UID_PROPERTY_="photon_uid"+Math.floor(2147483648*Math.random()).toString(36);b.nextUID_=0;b.getUID=function(a){return a[b.UID_PROPERTY_]||(a[b.UID_PROPERTY_]=++b.nextUID_)};b.extend=function(a,c,b,e){for(var f in c)if(!b||b(c,f))a[f]=e?e(c,f):c[f];return a};b.extend.filterHasOwnProperty=function(a,c){return a.hasOwnProperty(c)};b.extend.filterHasOwnFunction=function(a,
c){return a.hasOwnProperty(c)&&b.isFunction(a[c])};provide("photon.object",{toBoolean:function(a){return"boolean"==typeof a?a:b.isString(a)&&(a=a.toLowerCase(),b.object.toBoolean.map.hasOwnProperty(a))?b.object.toBoolean.map[a]:a?!0:!1},toNullableBoolean:function(a){return b.isNullOrUndefined(a)?null:b.object.toBoolean(a)},toText:function(a){return""+a},toNullableText:function(a){return b.isNullOrUndefined(a)?null:b.object.toString(a)},toNumber:function(a){return Number(a)},toNullableNumber:function(a){var c=
Number(a);return 0===c&&b.string.isWhiteSpace(a)?null:c},equals:function(a,c,d){d=d||[];if(a===c)return 0!==a||1/a==1/c;if(b.isNullOrUndefined(a)||b.isNullOrUndefined(c))return a===c;a._chain&&(a=a._wrapped);c._chain&&(c=c._wrapped);if(a.equals&&_.isFunction(a.equals))return a.equals(c);if(c.equals&&_.isFunction(c.equals))return c.equals(a);var e=D.toString.call(a);if(e!==D.toString.call(c))return!1;switch(e){case "[object String]":return a===""+c;case "[object Number]":return a!==+a?c!==+c:0===a?
1/a===1/c:a===+c;case "[object Date]":case "[object Boolean]":return+a===+c;case "[object RegExp]":return a.source===c.source&&a.global===c.global&&a.multiline===c.multiline&&a.ignoreCase===c.ignoreCase}if("object"!==typeof a||"object"!==typeof c)return!1;for(var f=d.length;f--;)if(d[f]===a)return!0;d.push(a);var f=0,g=!0;if("[object Array]"===e){if(f=a.length,g=f===c.length)for(;f--&&(g=f in a===f in c&&b.object.equals(a[f],c[f],d)););}else{if("constructor"in a!=="constructor"in c||a.constructor!==
c.constructor)return!1;for(var h in a)if(a.hasOwnProperty(h)&&(f++,!(g=c.hasOwnProperty(h)&&b.object.equals(a[h],c[h],d))))break;if(g){for(h in c)if(c.hasOwnProperty(h)&&!f--)break;g=!f}}d.pop();return g},getPropertyNames:function(a){var c=[],b=0,e;for(e in a)c[b++]=e;return c},getOwnPropertyNames:function(a){var c=[],b=0,e;for(e in a)a.hasOwnProperty(e)&&(c[b++]=e);return c},forEachOwnProperty:function(a,c,b){for(var e in a)a.hasOwnProperty(e)&&c.call(b,e)}});b.object.toBoolean.map={"true":!0,yes:!0,
1:!0,y:!0,"false":!1,no:!1,"0":!1,n:!1};provide("photon.string",{EMPTY:"",format:function(a){if(0!==arguments.length){if(1===arguments.length)return a;var c=k.makeArray(arguments).slice(1);return a.replace(/\{\{|\}\}|\{(\d+)\}/g,function(a,b){return"{{"===a?"{":"}}"===a?"}":c[b]})}},isWhiteSpace:function(a){return!/[^\t\n\r ]/.test(a)},trim:z&&z.trim?function(a){return z.trim.call(a)}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},split:5==="-A-B-A-C".split(/-(A)-/).length?function(a,
c,b){return z.split.call(a,c,b)}:function(){var a=void 0===/()??/.exec("")[1],c=function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(match[a]=void 0)};return function(b,e,f){if("[object RegExp]"!==Object.prototype.toString.call(e))return z.split.call(b,e,f);var g=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),i=0,j,w,k,e=RegExp(e.source,h+"g"),b=b+"";a||(j=RegExp("^"+e.source+"$(?!\\s)",h));for(f=void 0===f?4294967295:f>>>0;h=e.exec(b);){w=
h.index+h[0].length;if(w>i&&(g.push(b.slice(i,h.index)),!a&&1<h.length&&h[0].replace(j,c),1<h.length&&h.index<b.length&&Array.prototype.push.apply(g,h.slice(1)),k=h[0].length,i=w,g.length>=f))break;e.lastIndex===h.index&&e.lastIndex++}i===b.length?(k||!e.test(""))&&g.push(""):g.push(b.slice(i));return g.length>f?g.slice(0,f):g}}()});provide("photon.errors",{notImplemented:function(){return Error("Not implemented")},objectDisposed:function(){return Error("Object disposed")}});var r=function(a,c){if(!a)throw Error(c?
b.string.format.apply(null,[c].concat(l.slice.call(arguments,2))):"Value required.");return a};b.assert=r;provide("photon.expression");b.expression.makeScoped=function(a,c){for(var b=a,e=c.length-1;0<=e;e--)b="with("+c[e]+") { "+b+" } ";return b};provide("photon.functions");b.functions.makeScoped=function(a,c,d){3>arguments.length&&(d=c);return new Function(d,b.expression.makeScoped(a,c))};provide("photon.array",{find:function(a,c,d,e){c=b.array.findIndex(a,c,d,e);return-1!==c?a[c]:null},findIndex:function(a,
c,d,e){b.isFunction(c)&&(e=d,d=c,c=0);for(var f=a.length;c<f;c++)if(d.call(e,a[c],c,a))return c;return-1},map:l&&l.map?function(a,c,b){return l.map.call(a,c,b)}:function(a,c,d){for(var e=a.length,f=Array(e),g=b.isString(a)?a.split(""):a,h=0;h<e;h++)h in g&&(f[h]=c.call(d,g[h],h,a));return f},filter:l&&l.filter?function(a,c,b){return l.filter.call(a,c,b)}:function(a,c,d){for(var e=a.length,f=[],g=0,h=b.isString(a)?a.split(""):a,i=0;i<e;i++)if(i in h){var j=h[i];c.call(d,j,i,a)&&(f[g++]=j)}return f},
forEach:l&&l.forEach?function(a,c,b){l.forEach.call(a,c,b)}:function(a,c,d){for(var a=b.isString(a)?a.split(""):a,e=0,f=a.length;e<f;e++)e in a&&c.call(d,a[e],e,a)},indexOf:l&&l.indexOf?function(a,c,b){return l.indexOf.call(a,c,b)}:function(a,c,d){d=b.isNullOrUndefined(d)?0:0>d?Math.max(0,a.length+d):d;if(b.isString(a))return!b.isString(c)||1!==c.length?-1:a.indexOf(c,d);for(var e=a.length;d<e;d++)if(d in a&&a[d]===c)return d;return-1},removeDuplicates:function(a,c,d,e){b.isFunction(c)&&(e=d,d=c,
c=null);for(var c=c||a,f={},g=0,h=0;h<a.length;){var i=a[h++];d&&(i=d.call(e,i));var j=typeof i,j="object"===j&&null!==i?"o"+b.getUID(i):j.charAt(0)+i;f.hasOwnProperty(j)||(f[j]=!0,c[g++]=i)}c.length=g},diff:function(a,c,b){a={length:a.length,data:a,modified:[]};c={length:c.length,data:c,modified:[]};x(a,0,a.length,c,0,c.length,b||function(a,c){return a===c});return N(a,c)},toArray:function(a,c,d){if(b.isArray(a))return a;var e=[],c=c||0;for(b.isUndefined(d)&&(d=a.length-c);c<d;c++)e[c]=a[c];return e},
remove:function(a,c){var d=b.array.indexOf(a,c);return-1!==d?(a.splice(d,1),!0):!1}});b.StringBuilder=function(){this.bufferLength_=0;this.buffer_=[]};b.defineType(b.StringBuilder,{getLength:function(){return this.toString().length},clear:function(){this.bufferLength_=this.buffer_.length=0},push:function(a){this.buffer_[this.bufferLength_++]=a},pushAll:function(a){for(var c=0,b=a.length;c<b;c++)this.push(a[c])},get:function(){var a=this.buffer_.join("");this.set(a);return a},set:function(a){this.clear();
this.push(a)}});provide("photon.dom");b.dom.wrap=function(a,c,b){c=(b||document).createElement(c);c.appendChild(a);return c};b.dom.getHtml=function(a){if(b.isDocumentFragment(a)){var c=document.createElement("div");c.appendChild(a);for(var d=c.innerHTML;c.firstChild;)a.appendChild(c.firstChild);return d}return a.innerHTML};var o={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,
"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"]};o.optgroup=o.option;o.tbody=o.tfoot=o.colgroup=o.caption=o.thead;o.th=o.td;b.dom.htmlToFragmentOrNode=function(a,c){var c=c||document,b=c.createElement("div"),e=a.match(/^\s*<(t[dhr]|tbody|tfoot|thead|option|legend|col|area|optgroup|colgroup|caption)/i);if(e){var e=o[e[1].toLowerCase()],f=e[0];for(b.innerHTML=e[1]+a+e[2];f--;)b=b.lastChild}else b.innerHTML="<br>"+
a,b.removeChild(b.firstChild);if(1===b.childNodes.length)return b.removeChild(b.firstChild);for(e=c.createDocumentFragment();b.firstChild;)e.appendChild(b.firstChild);return e};b.dom.findParent=function(a,c,b){if(!a)return null;for(var e=a.parentNode;e&&!c.call(b,e,a);)e=e.parentNode;return e};b.dom.hasFocus=function(a,c){if(1===arguments.length)return a===document.activeElement;c?a.focus():a.blur()};(function(){var a=!b.isNullOrUndefined(k),c=[],d=function(a){for(var b=0,d=c.length;b<d;b++)c[b](a);
if(1===a.nodeType||9===a.nodeType)a.photonData=void 0},e=function(a){for(var a=b.array.toArray(a),c=0,e=a.length;c<e;c++)d(a[c])};if(a){if(!k.cleanData)throw Error("Could not override jQuery 'cleanData'!!");var f=k.cleanData;k.cleanData=function(a){e(a);f(a)}}b.dom.subscribeToCleanup=function(a){c.push(a)};b.dom.cleanNodes=function(a){for(var c=0,b=a.length;c<b;c++)this.cleanNode(a[c])};b.dom.remove=function(a){var c=a.parentNode;c&&c.removeChild(a)};b.dom.removeAndClean=function(a){b.dom.remove(a);
b.dom.cleanNode(a)};b.dom.cleanNode=a?function(a){(1===a.nodeType||9===a.nodeType)&&k.cleanData(a.getElementsByTagName("*"));k.cleanData([a])}:function(a){(1===a.nodeType||9===a.nodeType)&&e(a.getElementsByTagName("*"));d(a)};b.dom.empty=function(a){for(;a.firstChild;)b.dom.cleanNode(a.firstChild),a.removeChild(a.firstChild)}})();provide("photon.events",{add:function(a,c,b,e){k(a).on(c,b,e)}});provide("photon.observable");b.observable.unwrap=function(a){return b.isNullOrUndefined(a)?a:!0===a.isObservable&&
a.unwrap?a.unwrap(a):a};var E=0;provide("photon.observable.model",{createPropertyChangeNotifier_:function(a){return function(c,b){this[a].call(this,c,b)}},createPropertySetter_:function(a){return function(c){return this.set(a,c)}},createPropertyGetter_:function(a){return function(){return this.get(a)}},createPropertyAccessor_:function(a,c){var b=function(b){return b||0<arguments.length?(r(!c,"Property '{0}' is read only.",a),this.set(a,arguments[0])):this.get(a)};b.isPropertyAccessor=!0;return b},
defineProperties_:function(a,c,d){b.object.forEachOwnProperty(c,function(b){"property"===d?Object.defineProperty(a,b,{get:this.createPropertyGetter_(b),set:property.isReadOnly?null:this.createPropertySetter_(b),enumerable:!0,configurable:!1}):a[b]=this.createPropertyAccessor_(b,c[b].isReadOnly)},this)},getDefaultDisplayName_:function(a){a=a.replace(/([A-Z])/g," $1");return a.charAt(0).toUpperCase()+a.substring(1)},addExtension_:function(a,b,d){d&&d.define(a)},prepareModelDefinition_:function(a,c){var d=
{extensions:[],properties:{},methods:{}};c&&(b.extend(d.properties,c.properties),b.extend(d.methods,c.methods));var e=b.observable.model.extensions;b.object.forEachOwnProperty(e,function(b){var c=e[b];this.addExtension_(a,b,c);d.extensions.push(c)},this);b.object.forEachOwnProperty(a,function(c){var e=a[c];if(b.isFunction(e))d.methods[c]={methodName:c,method:e};else{if(!e||b.array.indexOf(["number","string","boolean"],typeof e)!==-1)e={initialValue:e};e.propertyName=c;d.properties[c]=this.preparePropertyDefinition_(e)}},
this);return d},preparePropertyDefinition_:function(a){var c={},d=a.type;d&&b.extend(c,r(b.observable.model.types[d],"Model type '{0}' has not been registered",d));b.extend(c,a);b.isString(c.beforeChange)&&(c.beforeChange=this.createPropertyChangeNotifier_(c.beforeChange));b.isString(c.afterChange)&&(c.afterChange=this.createPropertyChangeNotifier_(c.afterChange));if(c.coerce&&!b.isFunction(c.coerce))if(b.isString(c.coerce))c.coerce=b.observable.model.coercers[c.coerce];else if(b.isArray(c.coerce)){var e=
b.array.map(c.coerce,function(a){var c=b.isFunction(a)?a:b.observable.model.coercers[a];return r(c,"Coercion type '{0}' is not registered",a)});c.coerce=function(a){for(var b=0,c=e.length;b<c;b++)a=e[b](a);return a}}E||(c.metaData=c.metaData||{},b.extend(c.metaData,this.getDefaultPropertyMetaData(c)));E++;try{if(c.metaData){var f=b.observable.model.define(c.metaData);c.metaData=new f}}finally{E--}return c},define:function(a,c,d){1===arguments.length?(d=a,a=c=null):2===arguments.length&&(d=c,c=null);
d=this.prepareModelDefinition_(d,c?c.prototype.definition_:null);c||(c=b.observable.model.Base);a||(a=function(b){a.base(this,b)});b.defineType(a,c,{definition_:d});this.defineProperties_(a.prototype,d.properties,b.observable.model.defaultPropertyMode);b.extend(a.prototype,d.methods,b.extend.filterHasOwnProperty,function(a,b){return a[b].method});return a},isPropertyAccessor:function(a){return b.isFunction(a)&&a.isPropertyAccessor}});b.observable.model.defaultPropertyMode="function";b.observable.model.getDefaultPropertyMetaData=
function(a){return{displayName:{initialValue:this.getDefaultDisplayName_(a.propertyName)}}};b.observable.model.extensions={};b.observable.model.coercers={};b.observable.model.metaData=function(a,c){var d=b.isFunction(a)?a.prototype.definition_:a.definition_;return d?d.properties[c].metaData:null};b.observable.model.Base=function(a){this.initialize(a);if(b.isFunction(this.onInitialize))this.onInitialize()};b.defineType(b.observable.model.Base,{get:function(a){b.observable.DependencyTracker.registerDependency(this,
a);return this.propertyValues_[a]},set:function(a,b){var d=this.definition_.extensions,e=this.definition_.properties[a];if(!e)throw Error();var f=this.propertyValues_[a];if(f!==b){e.coerce&&(b=e.coerce(b,f));e.beforeChange&&e.beforeChange.call(this,f,b);for(var g=0;g<d.length;g++)d[g].beforeChange(this,e,f,b);this.propertyValues_[a]=b;e.afterChange&&e.afterChange.call(this,f,b);for(g=0;g<d.length;g++)d[g].afterChange(this,e,f,b);this.notifyPropertyChanged(a,f,b);return!0}return!1},notifyPropertyChanged:function(a,
b,d){if(this.subscribers_){a={sender:this,propertyName:a,oldValue:b,newValue:d};b=0;for(d=this.subscribers_.length;b<d;b++)this.subscribers_[b]&&this.subscribers_[b].notify(a)}},subscribe:function(a,c,d,e){4>arguments.length&&"String"===typeof c&&(e=d,d=c,c=null);d&&this.definition_.properties[d]&&(d=this.definition_.properties[d].propertyName);this.subscribers_=this.subscribers_||[];var f=new b.observable.Subscriber(this,a,c,d,e);this.subscribers_.push(f);return f},unsubscribe:function(a){return b.array.remove(this.subscribers_,
a)},initialize:function(a){this.propertyValues_={};var c=this;b.extend(this.propertyValues_,this.definition_.properties,b.extend.filterHasOwnProperty,function(b,e){var f=b[e],g=f.initializer?f.initializer(c):f.initialValue;a&&f.propertyName in a&&(g=a[f.propertyName]);return f.coerce?f.coerce(g,void 0):g})},isObservable:!0});b.observable.model.coercers.trim=function(a){return a?b.string.trim(a):""};b.observable.model.coercers.initCaps=function(a){for(var a=a.split(" "),b=0;b<a.length;b++)0<a.length&&
(a[b]=a[b].charAt(0).toUpperCase()+a[b].substring(1));return a.join(" ")};b.observable.model.coercers.upper=function(a){return a?a.toUpperCase():""};b.observable.model.coercers.lower=function(a){return a?a.toUpperCase():""};provide("photon.observable.model.types");b.extend(b.observable.model.types,{Boolean:{coerce:b.object.toBoolean,initialValue:!1},"Boolean?":{coerce:b.object.toNullableBoolean,initialValue:null},String:{coerce:b.object.toText,initialValue:""},"String?":{coerce:b.object.toNullableText,
initialValue:null},Number:{coerce:b.object.toNumber,initialValue:!1},"Number?":{coerce:b.object.toNullableNumber,initialValue:!1},ObservableArray:{coerce:function(a,c){if(b.isNullOrUndefined(a))return a;c||(c=new b.observable.Array);c.set(a);return c},initializer:function(){return new b.observable.Array}}});b.observable.Subscriber=function(a,b,d,e,f){this.owner_=a;this.callback_=b;d&&(this.callbackTarget_=d);e&&(this.propertyName_=e);"undefined"!==typeof f&&(this.data_=f)};b.extend(b.observable.Subscriber.prototype,
{dispose:function(){this.owner_&&this.owner_.unsubscribe(this);this.owner_=this.callback_=null},notify:function(a){if(this.callback_&&(a.data=this.data_,!this.propertyName_||a.propertyName===this.propertyName_))this.callback_.call(this.callbackTarget_||null,a)},isSubscribedTo:function(a,b){return this.owner_===a&&this.propertyName_===b},getOwner:function(){return this.owner_},propertyName:function(){return this.propertyName_},callbackTarget:function(){return this.callbackTarget_},callback:function(){return this.callback_},
data:function(){return this.data_}});b.defineType(b.observable.Array=function(a){this.array_=a||[]},{isObservable:!0,push:function(){var a=l.push.apply(this.array_,arguments);this.notifyChanged(!0);return a},pop:function(){if(0<this.array_.length){var a=this.array_.pop();this.notifyChanged(!0);return a}},shift:function(){if(0<this.array_.length){var a=this.array_.shift();this.notifyChanged(!0);return a}},unshift:function(){var a=l.unshift.apply(this.array_,arguments);this.notifyChanged(!0);return a},
reverse:function(){this.array_.reverse();this.notifyChanged(!1);return this},sort:function(a){this.array_.sort(a);this.notifyChanged(!1);return this},slice:function(a,c){return new b.observable.Array(this.array_.slice(a,c))},splice:function(a,b,d){var e=this.array_,f=e.length,g=l.splice.apply(e,arguments);this.notifyChanged(e.length!==f);return g},set:function(a){if(this!==a)if(a){var c=b.observable.unwrap(a);if(this.array_!==c){var d=this.length();if(!b.isArray(c)||a!==c){for(var a=[],e=0,f=c.length;e<
f;e++)a[e]=c[e];c=a}this.array_=c;((c=d!==this.length())||0<d)&&this.notifyChanged(c)}}else 0<this.length()&&this.set([])},remove:function(a){(a=b.array.remove(this.array_,a))&&this.notifyChanged(!0);return a},concat:function(){return new b.observable.Array(l.concat.apply(this.array_,arguments))},join:function(a){return new b.observable.Array(this.array_.join(a))},valueOf:function(){return this.array_.valueOf()},toString:function(){return this.array_.toString()},getItem:function(a){return this.array_[a]},
setItem:function(a,b){var d=this.array_.length;this.array_[a]=b;this.notifyChanged(d!==this.array_.length)},subscribe:function(a,c,d){this.subscribers_=this.subscribers_||[];a=new b.observable.Subscriber(this,a,c,null,d);this.subscribers_.push(a);return a},unsubscribe:function(a){return b.array.remove(this.subscribers_,a)},notifyChanged:function(a){var c=this.subscribers_;c&&(c=c.slice(0),b.array.forEach(c,function(b){(!b.propertyName()||a&&"length"===b.propertyName())&&b.notify({data:{}})}))},length:function(){b.observable.DependencyTracker.registerDependency(this,
"length");return this.array_.length},indexOf:function(a,c){return b.array.indexOf(this.array_,a,c)},findIndex:function(a,c){return b.array.findIndex(this.array_,a,c)},unwrap:function(){return this.array_}});(function(){function a(a,b,c){if(a)for(var d=0,i=a.length;d<i;d++)if(a[d]&&a[d].isSubscribedTo(b,c))return d;return-1}var c=[],d=null;b.defineType(b.observable.DependencyTracker=function(a,b){this.callbackTarget_=b;this.callback_=a;this.subscribers_=null},{dispose:function(){this.resetSubscribers(null);
this.callback_=this.callbackTarget_=null},resetSubscribers:function(a){if(this.subscribers_)for(var b=0,c=this.subscribers_.length;b<c;b++)null!==this.subscribers_[b]&&this.subscribers_[b].dispose();this.subscribers_=a},beginCapture:function(){c.push(d);d={tracker:this,subscribers:[]}},endCapture:function(){if(!(d&&d.tracker===this))throw Error("Tracker does not have capture.");this.resetSubscribers(d.subscribers);d=c.pop()}},{registerDependency:function(b,c){if(null!==d&&-1===a(d.subscribers,b,c)){var g=
d.tracker,h=a(g.subscribers_,b,c);-1!==h?(d.subscribers.push(g.subscribers_[h]),g.subscribers_[h]=null):d.subscribers.push(b.subscribe(d.tracker.callback_,d.tracker.callbackTarget_,c))}}})})();b.observable.model.Extension=function(){};b.defineType(b.observable.model.Extension,{define:function(){},beforeChange:function(){},afterChange:function(){}});provide("photon.binding");(function(){var a={},c=[],d,e={$dataContext:function(a){return(a=d.get(a))?a.getValue():null},$imports:{photon:b},$metaData:b.observable.model.metaData};
b.extend(b.binding,{getBindingTagNames:function(){return c},getBindingType:function(b){return a[b]},registerBindingType:function(d,e){-1===b.array.indexOf(c,d)&&c.push(d);a[d]=e},evaluateInContext:function(a,c,h,i,j,w){b.isNullOrUndefined(h)||h.beginCapture();d=a;try{return c(e,a.getValue(),i,j,w)}finally{d=null,b.isNullOrUndefined(h)||h.endCapture()}},updateBindings:function(a){if(b.isDocumentOrElement(a)){var c=b.binding.BindingContext.getInstance();b.templating.prepareFlowTemplates(a);b.binding.forEachBoundElement(a,
b.binding.getBindingTagNames(),function(a,d,e){for(var d=c.parseBindingExpressions(d,e),e=[],f=[],k=0,l=d.length;k<l;k++){var n=d[k],v=b.binding.NodeBindingInfo.getOrCreateForElement(a),p=v.getBindingByExpression(n);p||(p=d[k].createBinding(a),v.addBinding(p));n instanceof b.binding.data.DataBindingExpression&&"data"===n.getPropertyType()&&"context"===n.getPropertyName()?f.push(p):e.push(p)}b.array.forEach(f,function(a){a.bind()});b.array.forEach(e,function(a){a.bind()})})}},applyBindings:function(a,
c,d,e){b.isString(c)&&(e=d,d=c,c=void 0);b.isString(d)||(e=d,d=void 0);c||(c=document.body);if(b.isDocumentOrElement(c)){var j=b.binding.NodeBindingInfo.getOrCreateForElement(c).getOrCreateDataContext();j.setParent(e||b.binding.DataContext.getForElement(c.parentNode));j.setSource(a);j.setName(d);b.binding.updateBindings(c)}},registerImport:function(a,b){e.$imports[a]=b}})})();b.defineType(b.binding.BindingType=function(){},{getDefaultExpressionType:function(){throw b.errors.notImplemented();},getExpressionBuilderType:function(){throw b.errors.notImplemented();
}},{getBindingType:function(a){return a instanceof b.binding.BindingType?a:b.binding.getBindingType(a)}});b.defineType(b.binding.BindingBase=function(a,b){this.target_=a;this.expression_=b},{dispose:function(){this.target_=null;this.setDataContext(null)},getTarget:function(){return this.target_},getExpression:function(){return this.expression_},getDataContext:function(){return this.dataContext_},getDataSource:function(){return this.dataSource_},setDataContext:function(a){var b=this.dataContext_;b!==
a&&(b&&b.removeSubscriber(this),a&&a.addSubscriber(this),this.dataContext_=a,this.dataContextChanged())},dataContextValueChanged:function(){this.updateDataSource()},dataContextChanged:function(){this.updateDataSource()},updateDataContext:function(){this.target_.parentNode&&this.setDataContext(b.binding.DataContext.getForElement(this.getTarget()))},updateDataSource:function(){if(null!==this.dataContext_){var a=this.dataContext_.getValue();a!==this.dataSource_&&(this.dataSource_=a,this.dataSourceChanged())}},
dataSourceChanged:function(){}});b.binding.BindingExpression=function(a,b){this.createBinding_=a;this.text_=b};b.defineType(b.binding.BindingExpression,{getText:function(){return this.text_},createBinding:function(a){return new this.createBinding_(a,this)}});(function(){b.binding.BindingExpressionBuilder=function(a,b){this.type_=a;this.subtype_=b};b.defineType(b.binding.BindingExpressionBuilder,{getSourceOrThrow:function(){var a=this.getSource();if(!a)throw Error("Binding does not contain a valid source expression.");
return a},setSource:function(a){this.source_=a},getSource:function(){return this.source_},getType:function(){return this.type_},getSubType:function(){return this.subtype_},getText:function(){return this.text_},setText:function(a){this.text_=b.string.trim(a)},makeGetter:function(a){return b.functions.makeScoped(b.string.format("return ($imports.photon.observable.model.isPropertyAccessor({0})) ? {0}() : {0};",a),["$context","$data"])},makeSetter:function(a){return b.functions.makeScoped(b.string.format("if ($imports.photon.observable.model.isPropertyAccessor({0})) {0}({1}); else {0} = {1};",
a,"$value"),["$context","$data"],["$context","$data","$value"])},makeAction:function(a,c){return b.functions.makeScoped(a,["$context","$data"],["$context","$data"].concat(c||[]))}})})();b.defineType(b.binding.BindingContext=function(){this._cache={};this._bindingExpressionCache={}},{nextId_:0,identity:function(a){var b=a["photon.identity"];b||(b=this.nextId_++,a["photon.identity"]=b);this._cache[b]=a;return b},parseBindingExpressions:function(a,c){var a=b.binding.BindingType.getBindingType(a),d=a+
"-"+c;return this._bindingExpressionCache[d]||(this._bindingExpressionCache[d]=(new b.binding.ExpressionParser(a,c)).readAllRemaining())},lookup:function(a){return this._cache[a]}});b.binding.BindingContext.getInstance=function(){return b.binding.BindingContext.instance_||(b.binding.BindingContext.instance_=new b.binding.BindingContext)};(function(){var a=function(a){return b.string.isWhiteSpace(a)||","===a},c=/^[\_$a-z][\_$a-z0-9]*(\(\))?(\[.*?\])*(\(\))?(\.[\_$a-z][\_$a-z0-9]*(\(\))?(\[.*?\])*(\(\))?)*$/i;
b.defineType(b.binding.ExpressionParser=function(a,c){this.tokenizer_=new b.binding.ExpressionTokenizer(c);this.bindingType_=b.isString(a)?b.binding.getBindingType(a):a},{readExpression_:function(a){for(var a=a||"",e,f=0,g=0,h=this.tokenizer_,i=h.getPosition()-h.currentToken().length;(e=this.tokenizer_.currentToken())&&(g||!(","===e||"}"===e||e===a));)f+=e.length,-1!=="{([".indexOf(e)?g++:-1!==")}]".indexOf(e)&&g--,h.nextToken();a=b.string.trim(h.getText().substring(i,i+f));return!e&&!a?null:{text:a,
isWritable:c.test(a)&&")"!==a.charAt(a.length-1)}},getExpressionBuilder:function(a){a=a.split("-",2);1===a.length&&a.unshift(this.bindingType_.getDefaultExpressionType());return new (this.bindingType_.getExpressionBuilderType(a[0]))(a[0],a[1])},readNext:function(){var c,e,f=0,g=this.tokenizer_,h=g.getPosition();h&&h--;if("{"===(c=g.skipWhiteSpace()))c=g.skipWhiteSpace(!0);for(var i,j;c;){j=null;0===f?(j=this.readExpression_(":"),(c=g.currentToken())&&","!==c&&"{"!==c?(e=j.text,j=null):e=this.bindingType_.getDefaultExpressionType(null),
i=this.getExpressionBuilder(e)):(e=b.string.trim(c),c=g.nextToken());null===j&&(":"!==g.skipWhiteSpace()&&this.throwUnexpectedToken(":"),g.nextToken(),j=this.readExpression_(),c=g.currentToken());if(0===f++)i.setSource(j);else{var k="set-"+e;if(!b.isFunction(i[k]))throw Error(b.string.format("Unsupported binding property {0}.",e));i[k](j.text)}e=!c||"}"===c;i.setText(g.getText().substring(h,g.getPosition()));!e&&","!==c&&this.throwUnexpectedToken(",");c=g.skipWhile(a,!0);if(e)break}return i?i.build():
null},throwUnexpectedToken:function(a){var c=this.tokenizer_.currentToken();throw Error(b.string.format("Unexpected token at or near position {0}, expected: '{1}', actual: '{2}.', expression'{3}'",this.tokenizer_.getPosition()-c.length,a,c?c:"EOF",this.tokenizer_.getText()));},readAllRemaining:function(){for(var a=[],b;b=this.readNext();)a.push(b);return a}})})();(function(){var a={"{":"{","}":"}","(":"(",")":")",",":",",".":".",":":":",";":";","[":"[","]":"]"};b.binding.ExpressionTokenizer=function(c){var d=
0,e;this.getText=function(){return c};this.getPosition=function(){return d};this.currentToken=function(){return e};this.nextToken=function(){for(var b=d,g;g=c.charAt(d);){if(a.hasOwnProperty(g)){if(d>b)break;d++;return e=g}if('"'===g||"'"===g){if(d>b)break;d++;for(var h=g;g=c.charAt(d++);){if(g===h)return e=c.substring(b,d);"\\"===g&&d++}throw Error("Syntax error, unterminated string literal.");}d++}return d>b?e=c.substring(b,d):e=""};this.skipWhiteSpace=function(a){return this.skipWhile(b.string.isWhiteSpace,
a)};this.readWhile=function(a,b){for(var h=0,i=d,j=b||!i?this.nextToken():e;j&&a(j);)h+=(j=this.nextToken()).length;return 0<h?c.substring(i,i+h):""};this.skipWhile=function(a,b){for(var c=b||!d?this.nextToken():e;c&&a(c);)c=this.nextToken();return c}}})();provide("photon.binding.data");b.binding.data.DataBindingMode={Default:0,OneWay:1,TwoWay:2,OneTime:3};b.binding.data.DataBinding=function(a,c){b.binding.data.DataBinding.base(this,a,c)};b.defineType(b.binding.data.DataBinding,b.binding.BindingBase,
{bindUpdateSourceEvent:function(a){b.isArray(a)&&(a=a.join(" "));k(this.target_).bind(a,this,this.targetChanged)},targetChanged:function(a){a.data.updateSource(a)},updateSource:function(){var a=this.getExpression();a.setSourceValue(this.getDataContext(),null,a.getPropertyHandler().getValue(this))},getSourceValue:function(){return this.getExpression().getSourceValue(this.getDataContext(),this.dependencyTracker_)},getBindingMode:function(){var a=this.expression_.getMode()||b.binding.data.DataBindingMode.Default,
c=this.getExpression().getPropertyHandler();a===b.binding.data.DataBindingMode.Default&&(a=c.getDefaultBindingMode?c.getDefaultBindingMode(this):b.binding.data.DataBindingMode.OneWay);return a},dataSourceChanged:function(){this.updateSourceValue(this.dependencyTracker_)},updateSourceValue:function(a){a=this.getExpression().getSourceValue(this.getDataContext(),a);this.sourceValue_!==a&&(this.sourceValue_=a,this.sourceValueChanged())},sourceValueChanged:function(){this.getExpression().getPropertyHandler().setValue(this)},
ensureInitialized:function(){this.isInitialized_||(this.dependencyTracker_=new b.observable.DependencyTracker(function(){this.updateSourceValue(null)},this),b.addDisposable(this.target_,this.dependencyTracker_),this.getBindingMode()===b.binding.data.DataBindingMode.TwoWay&&this.expression_.getPropertyHandler().bindUpdateSourceTriggers(this),this.isInitialized_=!0)},bind:function(){this.ensureInitialized();var a=this.getExpression();if("data"===a.getPropertyType()&&"context"===a.getPropertyName()){var c=
this.getTarget(),d=b.binding.DataContext.getLocalForElement(c);d&&!d.isInherited?(d.setName(a.getName()),d.setBinding(this)):(d=b.binding.NodeBindingInfo.getOrCreateForElement(c).getOrCreateDataContext(),d.setName(a.getName()),d.setParent(b.binding.DataContext.getForElement(c.parentNode)),d.isInherited=!0,this.setDataContext(d.getParent()))}else this.updateDataContext()}});b.binding.data.DataBindingExpression=function(a,c,d,e,f,g,h,i){b.binding.data.DataBindingExpression.base(this,b.binding.data.DataBinding,
a);this.propertyType_=c;this.propertyName_=d;this.getter_=e;this.setter_=f;this.mode_=g;this.name_=h;this.isPrimary_=i;this.propertyHandler_=r(b.binding.data.properties[c+"."+d]||b.binding.data.properties[c],"Unsupported data binding type'{0}'",c)};b.defineType(b.binding.data.DataBindingExpression,b.binding.BindingExpression,{getName:function(){return this.name_},getMode:function(){return this.mode_},getIsPrimary:function(){return this.isPrimary_},getGetter:function(){return this.getter_},getSetter:function(){return this.setter_},
getPropertyHandler:function(){return this.propertyHandler_},getPropertyType:function(){return this.propertyType_},getPropertyName:function(){return this.propertyName_},getSourceValue:function(a,c){return b.binding.evaluateInContext(a,this.getter_,c)},setSourceValue:function(a,c,d){return b.binding.evaluateInContext(a,this.setter_,c,d)}});(function(){var a={$imports:{photon:b}};b.binding.data.DataBindingExpressionBuilder=function(a,d){b.binding.data.DataBindingExpressionBuilder.base(this,a,d)};b.defineType(b.binding.data.DataBindingExpressionBuilder,
b.binding.BindingExpressionBuilder,{build:function(){var c=this.getSourceOrThrow();b.isUndefined(this.mode_)&&(this.mode_=b.binding.data.DataBindingMode.Default);c.isWritable||(r(this.mode_!==b.binding.data.DataBindingMode.TwoWay,"Binding mode is TwoWay, but the source expression is not writable."),this.mode_===b.binding.data.DataBindingMode.Default&&(this.mode_=b.binding.data.DataBindingMode.OneWay));var d=this.makeGetter(c.text),e=this.convertFrom_,f;if(this.isWritableMode_(this.mode_)&&c.isWritable){var g=
this.makeSetter(c.text),h=this.convertTo_;f=function(b,c,d){if(arguments.length<3){d=c;c=b;b=a}h&&(d=h(d));g(b||a,c,d)}}return new b.binding.data.DataBindingExpression(this.getText(),this.getType(),this.getSubType(),function(b,c){if(c===void 0){c=b;b=a}var f=d(b,c);e&&(f=e(f));return f},f,this.mode_,this.name_,this.isPrimary_)},"set-mode":function(a){r(b.binding.data.DataBindingMode.hasOwnProperty(a),"Invalid binding mode '{0}'.",a);this.mode_=b.binding.data.DataBindingMode[a]},"set-name":function(a){this.name_=
a},"set-convertFrom":function(a){this.convertFrom_=this.getConverter_(a)},"set-convertTo":function(a){this.convertTo_=this.getConverter_(a)},"set-isPrimary":function(a){this.isPrimary_=b.object.toBoolean(a)},isWritableMode_:function(a){return a===b.binding.data.DataBindingMode.Default||a===b.binding.data.DataBindingMode.TwoWay},getConverter_:function(a){return new Function("$value","return "+a)}})})();b.binding.data.DataBindType=function(){};b.defineType(b.binding.data.DataBindType,b.binding.BindingType,
{getDefaultExpressionType:function(){return"property"},getExpressionBuilderType:function(){return b.binding.data.DataBindingExpressionBuilder}});b.binding.registerBindingType("data-bind",new b.binding.data.DataBindType);b.defineType(b.binding.data.Property=function(){},{getDefaultBindingMode:function(){return b.binding.data.DataBindingMode.OneWay},getValue:function(a){return a.getTarget()[a.getExpression().getPropertyName()]},setValue:function(a){a.getTarget()[a.getExpression().getPropertyName()]=
a.getSourceValue()}});b.defineType(b.binding.data.InputProperty=function(){},b.binding.data.Property,{getDefaultBindingMode:function(){return b.binding.data.DataBindingMode.TwoWay},bindUpdateSourceTriggers:function(a){a.bindUpdateSourceEvent("change")}});b.defineType(b.binding.data.FocusProperty=function(){},b.binding.data.Property,{bindUpdateSourceTriggers:function(a){a.bindUpdateSourceEvent("focus blur")},getDefaultBindingMode:function(){return b.binding.data.DataBindingMode.TwoWay},getValue:function(a){return b.dom.hasFocus(a.getTarget())},
setValue:function(a){b.dom.hasFocus(a.getTarget(),a.getSourceValue())}});b.defineType(b.binding.data.StyleProperty=function(){},b.binding.data.Property,{getValue:function(a){return k(a.getTarget()).css(a.getExpression().getPropertyName())},setValue:function(a){k(a.getTarget()).css(a.getExpression().getPropertyName(),a.getSourceValue())}});b.defineType(b.binding.data.DataContextProperty=function(){},b.binding.data.Property,{getValue:function(a){return b.binding.DataContext.getForElement(a.getTarget()).getSource()},
setValue:function(a){b.binding.DataContext.getForElement(a.getTarget()).setSource(a.getSourceValue())}});b.defineType(b.binding.data.AttributeProperty=function(){},b.binding.data.Property,{getValue:function(a){a.getTarget().getAttribute(a.getExpression().getPropertyName())},setValue:function(a){a.getTarget().setAttribute(a.getExpression().getPropertyName(),a.getSourceValue())}});b.defineType(b.binding.data.DataTemplateProperty=function(){},b.binding.data.Property,{getValue:function(a){return a.template},
templatesEqual:function(a,c){return a===c||b.isNullOrUndefined(a)&&b.isNullOrUndefined(c)?!0:b.isNullOrUndefined(a)||b.isNullOrUndefined(c)?!1:a.name===c.name&&a.data===c.data&&a.each===c.each},getFragment:function(a){var c=b.templating.getCache(),d=c.findFragment(a);d||(c.addElement(a),d=c.findFragment(a));return d},collectionChanged:function(a){this.setValue(a.data,!0)},setValue:function(a,c){var d=a.template,e=a.getSourceValue();if(c||!this.templatesEqual(d,e)){a.template=e;var d=a.getTarget(),
f=this.getFragment(e.name),g=b.binding.DataContext.getForElement(d);if(e.each){if(!this.renderer_||!this.renderer_.getReferenceElement())this.renderer_=new b.templating.ItemsRenderer(d,b.templating.RenderTarget.NextSibling,b.templating.getCache().getTemplate(e.name)),b.addDisposable(d,this.renderer_);this.renderer_.setData(e.each)}else b.dom.empty(d),b.templating.insertBeforeAndApplyBindings(d,f,null,e.data,g)}}});b.defineType(b.binding.data.ClassProperty=function(){},b.binding.data.Property,{getDefaultBindingMode:function(){return b.binding.data.DataBindingMode.OneWay},
getValue:function(a){return k(a.getTarget()).hasClass(a.getExpression().getPropertyName())},setValue:function(a){var b=a.getSourceValue(),d=a.getExpression().getPropertyName();b?k(a.getTarget()).addClass(d):k(a.getTarget()).removeClass(d)}});provide("photon.binding.data.properties");b.extend(b.binding.data.properties,{"null":{},property:new b.binding.data.Property,"property.value":new b.binding.data.InputProperty,"property.checked":new b.binding.data.InputProperty,"property.focus":new b.binding.data.FocusProperty,
style:new b.binding.data.StyleProperty,attribute:new b.binding.data.AttributeProperty,"data.context":new b.binding.data.DataContextProperty,"data.template":new b.binding.data.DataTemplateProperty,"class":new b.binding.data.ClassProperty});provide("photon.binding.actions");b.defineType(b.binding.actions.ActionBinding=function(a,c){b.binding.actions.ActionBinding.base(this,a,c)},b.binding.BindingBase,{onTriggered_:function(a){a.data.invoke(a)},bind:function(){this.isInitialized_||(b.events.add(this.getTarget(),
this.getExpression().getEvents(),this,this.onTriggered_),this.isInitialized_=!0);this.setDataContext(b.binding.DataContext.getForElement(this.getTarget()))},invoke:function(a){var c=this.getExpression();c.getStopPropagation()&&a.stopPropagation();b.binding.evaluateInContext(this.dataContext_,c.getAction(),null,a)}});b.defineType(b.binding.actions.ActionBindingExpression=function(a,c,d,e){b.binding.actions.ActionBindingExpression.base(this,b.binding.actions.ActionBinding,a);this.action_=c;d||(d="click");
this.events_=d.split(/\W+/).join(".photon ")+".photon";this.stopPropagation_=b.isUndefined(e)?!1:e?!0:!1},b.binding.BindingExpression,{getAction:function(){return this.action_},getStopPropagation:function(){return this.stopPropagation_},getEvents:function(){return this.events_}});b.defineType(b.binding.actions.ActionBindingExpressionBuilder=function(a,c,d){b.binding.actions.ActionBindingExpressionBuilder.base(this,a,c,d)},b.binding.BindingExpressionBuilder,{build:function(){var a=this.getSource();
if(!a)throw Error("Binding does not contain a valid source expression.");var c=this.makeAction(a.text,["$event"]);return new b.binding.actions.ActionBindingExpression(this.getText(),function(a,b,f){c(a||{},b,f)},this.events_,this.stopPropagation_)},"set-stopPropagation":function(a){this.stopPropagation_=b.object.toBoolean(a)},"set-events":function(a){this.events_=a}});b.defineType(b.binding.actions.ActionBindingType=function(){},b.binding.BindingType,{getDefaultExpressionType:function(){return"action"},
getExpressionBuilderType:function(){return b.binding.actions.ActionBindingExpressionBuilder}});b.binding.registerBindingType("data-action",new b.binding.actions.ActionBindingType);provide("photon.binding.flow");b.binding.flow.FlowBinding=function(a,c){b.binding.flow.FlowBinding.base(this,a,c);b.addDisposable(a,this);this.renderer_="if"===this.getExpression().getFlowType()?new b.templating.ConditionalRenderer(a,this.getExpression().getApplyTo(),b.templating.FlowTemplate.getForElement(a)):new b.templating.ItemsRenderer(a,
this.getExpression().getApplyTo(),b.templating.FlowTemplate.getForElement(a))};b.defineType(b.binding.flow.FlowBinding,b.binding.BindingBase,{dispose:function(){this.superType.dispose.call(this);this.renderer_&&(this.renderer_.dispose(),this.renderer_=null)},dataSourceChanged:function(){this.getDataContext()?this.updateFlowData(this.dependencyTracker_):this.renderer_.setData(void 0)},updateFlowData:function(a){this.renderer_.setData(this.getExpression().getFlowData(this.getDataContext(),a))},bind:function(){this.isInitialized_||
(this.dependencyTracker_=new b.observable.DependencyTracker(function(){this.updateFlowData(null)},this),b.addDisposable(this.target_,this.dependencyTracker_),this.isInitialized_=!0);this.updateDataContext()}});b.binding.flow.FlowBindingExpression=function(a,c,d,e){b.binding.flow.FlowBindingExpression.base(this,b.binding.flow.FlowBinding,a);this.flowType_=c;this.applyTo_=b.isNullOrUndefined(e)?b.templating.RenderTarget.Child:e;this.getFlowData_=d};b.defineType(b.binding.flow.FlowBindingExpression,
b.binding.BindingExpression,{getFlowType:function(){return this.flowType_},getFlowData:function(a,c){return b.binding.evaluateInContext(a,this.getFlowData_,c)},getApplyTo:function(){return this.applyTo_}});b.binding.flow.FlowBindingExpressionBuilder=function(a,c){b.binding.flow.FlowBindingExpressionBuilder.base(this,a,c)};b.defineType(b.binding.flow.FlowBindingExpressionBuilder,b.binding.BindingExpressionBuilder,{build:function(){var a=this.makeGetter(this.getSourceOrThrow().text);return new b.binding.flow.FlowBindingExpression(this.getText(),
this.getSubType(),a,this.applyTo_)},"set-applyTo":function(a){r(b.templating.RenderTarget.hasOwnProperty(a),"Invalid applyTo value '{0}'.",a);this.applyTo_=b.templating.RenderTarget[a]}});b.binding.flow.FlowBindingType=function(){};b.defineType(b.binding.flow.FlowBindingType,b.binding.BindingType,{getDefaultExpressionType:function(){return"flow"},getExpressionBuilderType:function(){return b.binding.flow.FlowBindingExpressionBuilder}});b.binding.registerBindingType("data-flow",new b.binding.flow.FlowBindingType);
b.dom.subscribeToCleanup(function(a){if((a=b.getData(a))&&a.disposables)for(var c=0,d=a.disposables.length;c<d;c++)a.disposables[c].dispose()});b.addDisposable=function(a,c){var d=b.getOrCreateData(a);(d.disposables=d.disposables||[]).push(c)};b.rewriteTemplate=function(a){return a.replace(/(<[a-z]([a-z]|\d)*(\s+(?!data-context=('templateSource[^']*'|"templateSource[^']*"))[a-z0-9\-]+(=("[^"]*"|'[^']*'))?)*\s+(data-context=((["'])templateSource:([\s\S]*?))\9))/gi,function(){var a=arguments.length,
d=new b.StringBuilder,e=arguments[0];d.push(e.substring(0,e.length-arguments[a-6].length));d.push("data-context-id=");e=arguments[a-4];d.push(e);b.rewriteScriptFragment(d,"=context.identity("+arguments[a-3]+")");d.push(e);return d.get()})};b.rewriteScriptFragment=function(a,b){a.pushAll(["<%",b,"%>"])};b.getOrCreateData=function(a){return a.photonData||(a.photonData={})};b.getData=function(a){return a.photonData};(function(){var a=document.querySelectorAll?function(a,d,e){var f="*["+d.join("], *[")+
"]";if(1===a.nodeType)for(var g=0,h=d.length;g<h;g++){var i=d[g],j=a.getAttribute(i);j&&e(a,i,j)}b.array.forEach(a.querySelectorAll(f),function(a){for(var b=0,c=d.length;b<c;b++){var f=d[b],g=a.getAttribute(f);g&&e(a,f,g)}})}:function(a,b,e){for(var a=a.getElementsByTagName("*"),f=0,g=a.length;f<g;f++)for(var h=a[f],i=0,j=b.length;i<j;i++){var k=b[i],l=h.getAttribute(k);l&&e(h,k,l)}};b.binding.forEachBoundElement=function(c,d,e){if(c=c||document)b.isString(d)&&(d=[d]),a(c,d,e)}})();var K={},F=[],
P={"&amp;":"&","&quot;":'"',"&lt;":"<","&gt;":">"};provide("photon.templating",{getBindingExpressionsFromHtml:function(a,c){a=O(a);c=c||"data-bind";r(b.binding.getBindingType(c));var d=K[c];d?d.lastIndex=0:d=K[c]=RegExp(b.string.format("(<[a-z]([a-z]|\\d)*(\\s+(?!{0}=)[a-z0-9\\-]+(=(\"[^\"]*\"|'[^']*'))?)*\\s+({0}=([\"'])([\\s\\S]*?)\\7))",c),"gi");for(var e=b.binding.BindingContext.getInstance(),f,g=[];f=d.exec(a);)Array.prototype.push.apply(g,e.parseBindingExpressions(c,f[f.length-1]));return g},
getPrimaryDataBindingExpressionFromHtml:function(a){a=b.templating.getBindingExpressionsFromHtml(a,"data-bind");1<a.length&&(a=b.array.filter(a,function(a){return a.isPrimary}));return 1===a.length?a[0]:null},afterRender:function(a){var b=F;if(0<b.length)for(var d=0,e=b.length;d<e;d++)b[d](a)},registerAfterRender:function(a){var b=F.slice(0);b.push(a);F=b},getHtml:function(a,c,d){var e=b.isString(a)?a:a.name,f=B.findHtml(e);f?c&&c.call(d,{template:f,completedSynchronously:!0}):a.url&&B.addResourceUrl(a.url,
function(a){c&&c.call(d,{template:B.findHtml(e),completedSynchronously:a.completedSynchronously})});return f},insertBefore:function(a,c,d,e){var f=[];if(b.isDocumentFragment(c))for(var g=c.childNodes,h=0,i=g.length;h<i;h++)f[h]=g[h];else f[0]=c;a.insertBefore(c,d);b.array.forEach(f,function(a){b.isDocumentOrElement(a)&&(a.parentDataContextNode=e,b.binding.updateBindings(a))});b.templating.afterRender(f);return f},insertBeforeAndApplyBindings:function(a,c,d,e,f){var g=[];if(b.isDocumentFragment(c))for(var h=
c.childNodes,i=0,j=h.length;i<j;i++)g.push(h[i]);else g.push(c);a.insertBefore(c,d);b.array.forEach(g,function(a){b.isDocumentOrElement(a)&&b.binding.applyBindings(e,a,f)});b.templating.afterRender(g);return g}});b.defineType(b.templating.TemplateCache=function(){this.templates_={}},{resourceDelimiterRegEx:/<\!--\s*Template:\s*([\w\.]*)\s*--\>/,getTemplate:function(a){return r(this.templates_[a],"No template could be found with key '{0}'.",a)},findTemplate:function(a){return this.templates_[a]},remove:function(a){var b=
this.templates_[a];b&&b.dispose();return delete this.templates_[a]},clear:function(){b.array.forEach(b.object.getOwnPropertyNames(this.templates_),function(a){this.remove(a)},this)},getFragment:function(a){return this.getTemplate(a).getFragment()},findFragment:function(a){return(a=this.templates_[a])?a.getFragment():null},getHtml:function(a){return this.getTemplate(a).getHtml()},findHtml:function(a){return(a=this.templates_[a])?a.template:null},addHtml:function(a,c){this.remove(a);var d=b.dom.wrap(b.dom.htmlToFragmentOrNode(c),
"div"),e=b.templating.prepareFlowTemplates(d),f=new b.templating.Template(null,a);0<e.length?(f.setTemplate(d.innerHTML),b.array.forEach(e,function(a){this.addChild(a)},f)):f.setTemplate(c);this.templates_[a]=f},addElement:function(a,c){var d=b.isElement(a)?a:document.getElementById(a);r(d,"Invalid element specification {0}.",a);r(c?c:c=d.id,"A name must be specified if the element does not have an id.");this.addHtml(c,d.innerHTML)},addResourceElement:function(a,c){var d=b.isElement(a)?a:document.getElementById(a);
r(d,"Invalid element specification {0}.",a);this.addResourceHtml(c||d.id,d.innerHTML)},addResourceHtml:function(a,c,d){c=b.string.trim(c);c=b.string.split(c,d||this.resourceDelimiterRegEx);if(1===c.length)this.addHtml(a,c[0]);else for(var a=a?a+".":"",d=c[0]?0:1,e=c.length;d<e&&d!==e;d+=2)this.addHtml(a+c[d],b.string.trim(c[d+1]))},addResourceUrl:function(a,c,d){function e(a){i.isSuccess=i.isSuccess&&a;!--j&&c&&(i.completedSynchronously=h,c(i))}function f(a){k.ajax({type:"GET",url:a}).done(function(a){var b=
!0;try{k(a).filter("script").each(function(a,b){g.addResourceHtml(b.id,k(b).html(),d)})}catch(f){if(b=!1,!c)throw f;}e(b)}).fail(function(){e(!1)})}var g=this;b.isArray(a)||(a=[a]);for(var h=!0,i={isSuccess:!0},j=a.length,l=0,o=j;l<o;l++)f(a[l]);h=!1}});var B=new b.templating.TemplateCache;b.templating.getCache=function(){return B};b.defineType(b.templating.Template=function(a,b){this.parent_=null;a&&a.addChild(this);b&&(this.key_=b)},{dispose:function(){var a=this.children_;if(a)for(var b=0,d=a.length;b<
d;b++)a[b].dispose()},getKey:function(){return this.key_},addChild:function(a){a.parent_=this;var b=this.children_;b?b.push(a):this.children_=[a]},getChild:function(a){return this.children_?this.children_[a]:0},getChildCount:function(){return this.children_?this.children_.length:0},getParent:function(){return this.parent_},setTemplate:function(a){if(this.html_||this.fragment_)throw Error("Template cannot be modified once set.");b.isDocumentFragment(a)?this.fragment_=a:this.html_=a},getHtml:function(){if(!this.html_){if(!this.fragment_)return null;
this.html_=b.dom.getHtml(this.fragment_)}return this.html_},getFragment:function(){if(!this.fragment_){if(!this.html_)return null;var a=b.dom.htmlToFragmentOrNode(this.html_),c=a;b.isDocumentFragment(a)||(c=document.createDocumentFragment(),c.appendChild(a));this.fragment_=c}return this.fragment_.cloneNode(!0)},insertBefore:function(a,c,d){return b.templating.insertBefore(a,this.getFragment(),c,d)}});var C={},L=0;b.defineType(b.templating.FlowTemplate=function(a){C[++L]=this;b.templating.FlowTemplate.base(this,
a,L)},b.templating.Template,{dispose:function(){var a=this.key_;a&&(b.templating.FlowTemplate.superType.dispose.call(this),delete C[a],delete this.key_)}},{getForElement:function(a){return C[a.getAttribute("data-template-id")]}});b.templating.prepareFlowTemplates=function(a){var b=[];1===a.nodeType&&a.getAttribute("data-flow")&&!a.getAttribute("data-template-id")&&G(b,a,a);k("*[data-flow]:not(*[data-template-id])",a).each(function(d,e){G(b,e,a)});for(var d=0,e=b.length;d<e;d++)H(b[d]);return b};b.templating.getFlowTemplateCache_=
function(){return C};b.dom.subscribeToCleanup(function(a){if(b.isElement(a)){var c=a.flowTemplate_;c&&(c.getParent()||c.dispose(),a.flowTemplate_=void 0)}});var M=function(a){this.pool_=[];this.poolIndex_=0;this.template_=a};b.defineType(M,{addToPool:function(a){this.pool_.push(a);b.array.forEach(a,b.dom.remove)},getFragment:function(){if(this.poolIndex_<this.pool_.length){var a=this.pool_[this.poolIndex_++];if(1===a.length)return a[0];for(var b=document.createDocumentFragment(),d=0,e=a.length;d<
e;d++)b.appendChild(a[d]);return b}return this.template_.getFragment()},dispose:function(){for(var a=this.poolIndex_,c=this.pool_.length;a<c;a++)b.dom.cleanNodes(this.pool_[a]);this.pool_=this.poolIndex_=void 0}});b.templating.Renderer=function(a,b,d){this.referenceElement_=a;this.renderTarget_=b;this.template_=d};b.defineType(b.templating.Renderer,{dispose:function(){this.referenceElement_=this.data_=this.template_=void 0},getReferenceElement:function(){return this.referenceElement_},setData:function(a,
b){this.data_!==a?(this.data_=a,this.onDataChanged()):b&&this.refresh()},getData:function(){return this.data_},onDataChanged:function(){this.refresh()},refresh:function(){}});b.templating.ConditionalRenderer=function(a,c,d){b.templating.ConditionalRenderer.base(this,a,c,d)};b.defineType(b.templating.ConditionalRenderer,b.templating.Renderer,{refresh:function(){var a=this.renderedNodes_,c=this.referenceElement_;this.data_?a||(this.renderedNodes_=this.renderTarget_===b.templating.RenderTarget.Child?
this.template_.insertBefore(c,null):this.template_.insertBefore(c.parentNode,c.nextSibling,c)):a&&(b.array.forEach(a,b.dom.removeAndClean),this.renderedNodes_=null)}});b.templating.ItemsRenderer=function(a,c,d){b.templating.ItemsRenderer.base(this,a,c,d)};b.defineType(b.templating.ItemsRenderer,b.templating.Renderer,{dispose:function(){this.subscribe_(null);this.superType.dispose.call(this);this.renderedNodes_=null},refresh:function(){if(this.data_){var a=this.data_;this.subscribe_(a);a=b.observable.unwrap(a)||
[];this.render_(this.itemsCopy_||[],a);this.itemsCopy_=a.slice(0)}},subscribe_:function(a){var b=this.subscriber_;b&&b.getOwner()!==a&&(b.dispose(),this.subscriber_=b=null);!b&&a&&a.subscribe&&(this.subscriber_=a.subscribe(this.refresh,this))},render_:function(a,c){this.renderedNodes_=this.renderedNodes_||[];var d=b.array.diff(a,c),e,f;f=this.referenceElement_;for(var g=this.renderedNodes_,h,i=0,j=null,k=new M(this.template_),l=this.renderTarget_===b.templating.RenderTarget.Child?f:f.parentNode,o=
b.binding.DataContext.getForElement(f),n=0,r=d.length;n<r;n++){e=d[n];var p=Math.min(e.deletedA,e.insertedB),s=f=e.startA-i;for(h=f+e.deletedA-p;s<h;s++,i++)k.addToPool(g[s]);g.splice(f,e.deletedA-p);for(s=0;s<p;s++)h=g[f++],(h=b.array.find(h,function(a){return null!=b.binding.DataContext.getLocalForElement(a)}))&&b.binding.DataContext.getLocalForElement(h).setSource(c[e.startB+s]);e.startA=f;e.startB+=p;e.insertedB-=p;e.deletedA=0}this.renderTarget_===b.templating.RenderTarget.NextSibling&&0<g.length&&
(h=g[g.length-1],j=h[h.length-1].nextSibling);for(n=i=0;n<r;n++){e=d[n];f=e.startA+i;p=g[f]?g[f][0]:j;s=e.startB;for(e=s+e.insertedB;s<e;s++,i++)g.splice(f++,0,b.templating.insertBeforeAndApplyBindings(l,k.getFragment(),p,c[s],o))}k.dispose()}});b.templating.RenderTarget={Child:0,NextSibling:1};b.defineType(b.binding.DataContext=function(){this.value_=void 0},{dispose:function(){this.removeFromParent_();delete this.parent_},removeFromParent_:function(){var a=this.parent_;a&&(b.array.remove(a.children_,
this),0===a.children_.length&&delete a.children_)},setParent:function(a){if(!b.isNullOrUndefined(a)&&!a instanceof b.binding.DataContext)throw Error("Value must be of type DataContext.");this.parent_!==a&&(this.removeFromParent_(),a?(this.parent_=a,a.children_?a.children_.push(this):a.children_=[this]):delete this.parent_,this.parentChanged())},getParent:function(){return this.parent_},getChild:function(a){return this.children_?this.children_[a]:null},getSource:function(){return this.source_},setSource:function(a){this.source_!=
a&&(this.source_=a,this.updateValue_())},setBinding:function(a){this.binding_!=a&&(this.binding_=a,this.updateValue_())},getBinding:function(){return this.binding_},updateValue_:function(){var a=this.source_;if(this.binding_){var b=this.value_;this.value_=a;a=this.value_=this.binding_.getExpression().getSourceValue(this);if(b!==a)this.onValueChanged_()}else this.value_!==a&&(this.value_=a,this.onValueChanged_())},getValue:function(){return this.value_},setName:function(a){this.name_=a},getName:function(){return this.name_},
onValueChanged_:function(){var a=this.subscribers_;a&&(a=a.slice(0),b.array.forEach(a,this.notifyValueChanged,this))},addSubscriber:function(a){this.subscribers_?this.subscribers_.push(a):this.subscribers_=[a]},removeSubscriber:function(a){var c=!1;this.subscribers_&&(c=b.array.remove(this.subscribers_,a),0===this.subscribers_.length&&delete this.subscribers_);return c},notifyValueChanged:function(a){a.dataContextValueChanged(this,this.value_)},getChildCount:function(){return this.children_?this.children_.length:
0},parentChanged:function(){},get:function(a){if(0===arguments.length)return this;var c=this;if(b.isString(a))for(;c&&c.getName()!==a;)c=c.parent_;else for(var d=0;d++<a&&c;)c=c.parent_;return c}},{getForElement:function(a){for(;a;a=a.parentDataContextNode||a.parentNode){var b=this.getLocalForElement(a);if(b)return b}return null},getLocalForElement:function(a){if(a=b.binding.NodeBindingInfo.getForElement(a))if(a=a.getDataContext())return a;return null}});b.binding.NodeBindingInfo=function(){};b.defineType(b.binding.NodeBindingInfo,
{dispose:function(){this.dataContext_&&(this.dataContext_.dispose(),this.dataContext=null);this.bindings_&&(b.array.forEach(this.bindings_,function(a){a.dispose()}),this.bindings_=null)},getBindingCount:function(){return this.bindings_?this.bindings_.length:0},getBinding:function(a){return this.bindings_?this.bindings_[a]:null},findBinding:function(a,c){return this.bindings_?b.array.find(this.bindings_,a,c):null},addBinding:function(a){this.bindings_?this.bindings_.push(a):this.bindings_=[a]},getBindingByExpression:function(a){var c=
a;b.isString(a)||(c=a.getText());return this.bindings_?b.array.find(this.bindings_,function(a){return c===a.getExpression().getText()}):null},getDataContext:function(){return this.dataContext_},getOrCreateDataContext:function(){return this.dataContext_?this.dataContext_:this.dataContext_=new b.binding.DataContext}},{getForElement:function(a){return(a=b.getData(a))?a.nodeBindingInfo:null},getOrCreateForElement:function(a){a=b.getOrCreateData(a);if(a.nodeBindingInfo)return a.nodeBindingInfo;a.nodeBindingInfo=
new b.binding.NodeBindingInfo;(a.disposables=a.disposables||[]).push(a.nodeBindingInfo);return a.nodeBindingInfo}});provide("photon.ui");b.defineType(b.ui.Selector=function(a){this.target_=a;this.items_=null;this.evaluationDataContext_=new b.binding.DataContext},{getItem_:function(a){var c=b.observable.unwrap(this.items_);return c?c[a]:void 0},getInContext:function(a,c,d){var e=a;e||(e=this.evaluationDataContext_,e.setParent(b.binding.DataContext.getForElement(this.target_)),e.setSource(d));try{return b.binding.evaluateInContext(e,
c,null)}finally{a||(e.setParent(null),e.setSource(null))}},getDisplay:function(a){return this.displayEvaluator_?this.getInContext(null,this.displayEvaluator_,a):a?a.toString():""},getValue:function(a){return this.valueEvaluator_?this.getInContext(null,this.valueEvaluator_,a):a},setValueEvaluator:function(a){this.valueEvaluator_!==a&&(this.valueEvaluator_=a)},getValueEvaluator:function(){return this.valueEvaluator_},setDisplayEvaluator:function(a){this.displayEvaluator_!==a&&(this.displayEvaluator_=
a,this.update())},getDisplayEvaluator:function(){return this.displayEvaluator_},getTarget:function(){return this.target_},getItems:function(){return this.items_},setItems:function(a){if(this.items_!==a){this.subscriber_&&(this.subscriber_.dispose(),delete this.subscriber_);if((this.items_=a)&&a.isObservable)this.subscriber_=a.subscribe(this.update,this);this.update()}},update:function(){var a=this.target_,c=this.getSelectedItem();b.dom.empty(a);if(this.items_){var d=b.observable.unwrap(this.items_);
b.array.forEach(d,function(c){var d="<option>"+this.getDisplay(c)+"</option>";b.binding.applyBindings(c,k(d).appendTo(a)[0])},this);a.selectedIndex=this.findIndexByValue(c)}},getSelectedItem:function(){var a=this.target_.selectedIndex;return-1===a?null:this.getValue(this.getItem_(a))},setSelectedItem:function(a){this.getSelectedItem()!==a&&(this.getTarget().selectedIndex=this.findIndexByValue(a))},findIndexByValue:function(a){return this.items_?b.array.findIndex(b.observable.unwrap(this.items_),function(b){return this.getValue(b)===
a},this):-1}});b.defineType(b.ui.SelectorProperty=function(a){this.propertyName_=a},b.binding.data.Property,{ensureInitialized:function(a){var c=a.getTarget();if("SELECT"!==c.tagName)throw Error("Expected selector");c=b.getOrCreateData(c);return c.selector?c.selector:c.selector=new b.ui.Selector(a.getTarget())},getValue:function(a){return this.ensureInitialized(a)["get"+this.propertyName_]()},setValue:function(a){this.ensureInitialized(a)["set"+this.propertyName_](a.getSourceValue())}});b.defineType(b.ui.SelectorItemsProperty=
function(){b.ui.SelectorItemsProperty.base(this,"Items")},b.ui.SelectorProperty);b.defineType(b.ui.SelectorSelectedItemProperty=function(){b.ui.SelectorSelectedItemProperty.base(this,"SelectedItem")},b.ui.SelectorProperty,{getDefaultBindingMode:function(){return b.binding.data.DataBindingMode.TwoWay},bindUpdateSourceTriggers:function(a){a.bindUpdateSourceEvent("change")},ensureInitialized:function(a){var c=b.ui.SelectorSelectedItemProperty.superType.ensureInitialized.call(this,a);c.isInit||(c.setSelectedItem(a.getSourceValue()),
c.isInit=!0);return c}});b.defineType(b.ui.SelectorDisplayProperty=function(){b.ui.SelectorDisplayProperty.base("DisplayEvaluator")},b.ui.SelectorProperty,{setValue:function(a){var c=a.getSourceValue(),c=b.binding.BindingContext.getInstance().parseBindingExpressions("data-bind","null:"+c)[0];return this.ensureInitialized(a).setDisplayEvaluator(c.getGetter())}});b.defineType(b.ui.SelectorValueProperty=function(){b.ui.SelectorValueProperty.base("ValueEvaluator")},b.ui.SelectorProperty,{setValue:function(a){var c=
a.getSourceValue(),c=b.binding.BindingContext.getInstance().parseBindingExpressions("data-bind","null:"+c)[0];return this.ensureInitialized(a).setValueEvaluator(c.getGetter())}});b.binding.data.properties["select.selectedItem"]=new b.ui.SelectorSelectedItemProperty;b.binding.data.properties["select.items"]=new b.ui.SelectorItemsProperty;b.binding.data.properties["select.value"]=new b.ui.SelectorValueProperty;b.binding.data.properties["select.display"]=new b.ui.SelectorDisplayProperty;b.slickGrid=
b.slickGrid||{};b.slickGrid.create=function(a,c,d,e){return(new b.slickGrid.Control(a,c,d,e)).grid_};b.slickGrid.dataItemColumnValueExtractor=function(a,b){return b.bindingExpression?b.bindingExpression.getGetter()(a):a[b.field]};b.slickGrid.defaultEditor=function(a){var b,d;this.init=function(){b=k("<INPUT type=text class='editor-text' />");b.bind("keydown.nav",function(a){(a.keyCode===k.ui.keyCode.LEFT||a.keyCode===k.ui.keyCode.RIGHT)&&a.stopImmediatePropagation()});b.appendTo(a.container);b.focus().select()};
this.destroy=function(){b.remove()};this.focus=function(){b.focus()};this.loadValue=function(e){d=a.column.bindingExpression.getGetter()(e);b.val(d);b[0].defaultValue=d;b.select()};this.serializeValue=function(){return b.val()};this.applyValue=function(b,c){a.column.bindingExpression.getSetter()(b,c)};this.isValueChanged=function(){return!(""===b.val()&&null===d)&&b.val()!==d};this.validate=function(){return{valid:!0}};this.init()};b.slickGrid.defaultMultiColumnSort=function(a,b){var d=b.sortCols,
e=b.grid.getOptions().dataItemColumnValueExtractor;e||(e=function(a,b){return a[b.field]});b.grid.getData().sort(function(a,b){for(var c=0,i=d.length;c<i;c++){var j=d[c].sortAsc?1:-1,k=e(a,d[c].sortCol),l=e(b,d[c].sortCol),j=(k===l?0:k>l?1:-1)*j;if(0!==j)return j}return 0});b.grid.invalidate();b.grid.render()};b.slickGrid.ItemsProperty=function(){};b.defineType(b.slickGrid.ItemsProperty,b.binding.data.Property,{getValue:function(a){return(a=a.getTarget().slickGrid)?a.getData():null},setValue:function(a){var c=
a.getTarget().slickGrid;if(c){var d=a.getSourceValue(),e=c.getData(),f=b.observable.unwrap(d);e!==f&&(a.subscriber_&&(a.subscriber_.dispose(),a.subscriber=null),d&&d.subscribe&&(a.subscriber_=d.subscribe(function(){this.onItemsChanged_(a)},this)),setTimeout(function(){c.setData(f);c.render()},0))}},onItemsChanged_:function(a){var c=a.getTarget().slickGrid;c&&(a=b.observable.unwrap(a.getSourceValue()),c.getData()!==a&&c.setData(a||[]),c.invalidate())}});b.slickGrid.SelectedItemProperty=function(){};
b.defineType(b.slickGrid.SelectedItemProperty,b.binding.data.Property,{getDefaultBindingMode:function(){return b.binding.data.DataBindingMode.TwoWay},bindUpdateSourceTriggers:function(){},ensureInitialized_:function(a){if(!a.isInit_){a.isInit_=!0;var b=a.getTarget().slickGrid;b.getSelectionModel()||b.setSelectionModel(new Slick.RowSelectionModel);b.onSelectedRowsChanged.subscribe(function(){a.updateSource()})}},getValue:function(a){this.ensureInitialized_(a);var a=a.getTarget().slickGrid,b=a.getSelectedRows();
return 0<b.length?a.getDataItem(b[0]):null},setValue:function(a){this.ensureInitialized_(a);var b=a.getTarget().slickGrid,a=a.getSourceValue();if(null===a)b.setSelectedRows([]);else for(var d=0,e=b.getDataLength();d<e;d++)b.getDataItem(d)===a&&b.setSelectedRows([d])}});b.binding.data.properties["slick.items"]=new b.slickGrid.ItemsProperty;b.binding.data.properties["slick.selectedItem"]=new b.slickGrid.SelectedItemProperty;b.slickGrid.Control=function(a,c,d,e){for(var f=b.binding.BindingContext.getInstance(),
g=this,h=0;h<d.length;h++){var i=d[h];if(i.binding&&(i.editable&&!i.editor&&(i.editor=b.slickGrid.defaultEditor),e.dataItemColumnValueExtractor=e.dataItemColumnValueExtractor||b.slickGrid.dataItemColumnValueExtractor,!i.bindingExpression))i.bindingExpression=f.parseBindingExpressions("data-bind","null:"+i.binding)[0];if(i.bindingTemplate&&(i.formatter||(i.formatter=this.createTemplateFormatter_(e.enableAsyncPostRender)),!i.binding&&!i.bindingExpression&&(i.bindingExpression=b.templating.getPrimaryDataBindingExpressionFromHtml(i.bindingTemplate)),
e.enableAsyncPostRender))i.asyncPostRender=function(a,b,c,d){g.postRender_(a,b,c,d)}}this.nodeCleaner_=new b.dom.NodeGarbageCollector;this.grid_=k(a)[0].slickGrid=new Slick.Grid(a,c,d,e)};b.defineType(b.slickGrid.Control,{postRender_:function(a,c,d){b.binding.applyBindings(d,a);this.nodeCleaner_.monitor(a);this.nodeCleaner_.postCollect()},createTemplateFormatter_:function(a){var b=this;return a?function(a,b,c,g){return g.bindingTemplate}:function(a,e,f,g){f=g.bindingTemplate;b.enqueueBinding_({row:a,
cell:e});return f}},applyBindings_:function(){var a=this.pendingBindings_,c=this.grid_;this.pendingBindings_=null;for(var d=0,e=a.length;d<e;d++){var f=a[d],g=c.getCellNode(f.row,f.cell);g&&(b.binding.applyBindings(c.getDataItem(f.row),g),this.nodeCleaner_.monitor(g),this.nodeCleaner_.postCollect())}},enqueueBinding_:function(a){if(this.pendingBindings_)this.pendingBindings_.push(a);else{this.pendingBindings_=[a];var b=this;setTimeout(function(){b.applyBindings_()},0)}}});b.dom.NodeGarbageCollector=
function(){this.nodes_=[]};b.defineType(b.dom.NodeGarbageCollector,{monitor:function(a){-1===b.array.indexOf(this.nodes_,a)&&this.nodes_.push(a)},postCollect:function(){if(!this.collectPending_){this.collectPending_=!0;var a=this;setTimeout(function(){try{a.collect()}finally{a.collectPending_=!1}},0)}},collect:function(){for(var a=this.nodes_,c=[],d=0,e=0,f=a.length;e<f;e++){var g=a[e];document.body.contains(g)?c[d++]=g:b.dom.cleanNode(g)}this.nodes_=c}});b.provide("photon.jQuery.ui");b.defineType(b.jQuery.ui.AutoCompleteOptionsProperty=
function(){},b.binding.data.Property,{adjustOptions:function(){},replaceMethod:function(a,b,d){var e=a[b];e!==d&&!e.originalFn_&&(a[b]=d,a.originalFn_=d)},resetMethod:function(a,b){var d=a[b];d.originalFn_&&(a[b]=d.originalFn_)},getValue:function(a){return a.options},setValue:function(a){var c=a.getSourceValue();if(!b.object.equals(a.options,c)){a.options=c;var d=k(a.getTarget()),e=k(d).autocomplete(c).data("autocomplete"),f=e._suggest;this.replaceMethod(e,"_suggest",function(b){a.selectionExecuted||
f.call(e,b)});this.replaceMethod(e,"_resizeMenu",function(){e.menu.element.outerWidth(d.outerWidth())});if(c.menuTemplate&&c.itemTemplate)throw Error("Cannot specify both menuTemplate and itemTemplate.");c.menuTemplate?this.replaceMethod(e,"_renderMenu",function(b){J(b,a.getDataContext().getValue(),c.menuTemplate);return b}):this.resetMethod(e,"_renderMenu");c.itemTemplate?this.replaceMethod(e,"_renderItem",function(a,b){J(a,b,c.itemTemplate);return a}):this.resetMethod(e,"_renderItem");c.submit&&
d.bind("keydown.autocomplete",function(b){var e=k.ui.keyCode;b.keyCode===e.ENTER||b.keyCode===e.NUMPAD_ENTER?(c.submit(d.val()),d.autocomplete("widget").hide(),a.selectionExecuted=!0):a.selectionExecuted=!1})}}});b.defineType(b.jQuery.ui.AutoCompleteItemProperty=function(){},b.binding.data.Property,{getValue:function(a){return k(a.getTarget()).data("item.autocomplete")},setValue:function(a){k(a.getTarget()).data("item.autocomplete",a.getSourceValue())}});b.binding.data.properties["autoComplete.options"]=
new b.jQuery.ui.AutoCompleteOptionsProperty;b.binding.data.properties["autoComplete.item"]=new b.jQuery.ui.AutoCompleteItemProperty;b.provide("photon.validation");b.validation.ValidationExtension=function(){b.validation.ValidationExtension.base(this)};b.defineType(b.validation.ValidationExtension,b.observable.model.Extension,{define:function(a){var c=this;b.extend(a,{errors:{type:"ObservableArray"},validate:function(){if(this.onValidate)this.onValidate();c.validateModel(this)}});b.object.forEachOwnProperty(a,
function(c){var e=a[c];if(e&&"object"===typeof e){var f=e.validationRules;if(f){var g=[];b.object.forEachOwnProperty(f,function(a){var c=b.assert(b.validation.rules[a],"Unknown rule type {0}.",a);g.push(new c(f[a]))});a[c].validationRules=g}}})},findRuleError:function(a,c){var d=a.errors().unwrap();return b.array.findIndex(d,function(a){return a.getRule()===c})},afterChange:function(a,b,d,e){this.validateProperty(a,b,e)},validateModel:function(a){var c=a.definition_;b.object.forEachOwnProperty(c.properties,
function(b){var e=c.properties[b];e.validationRules&&this.validateProperty(a,e,a.get(b))},this)},validateProperty:function(a,b,d){var e=b.validationRules;if(e)for(var f=0,g=e.length;f<g;f++){var h=e[f],i=this.findRuleError(a,h);(h=h.validate(a,b,d))?-1===i&&a.errors().push(h):-1!==i&&a.errors().splice(i,1)}}});b.observable.model.extensions.validation=new b.validation.ValidationExtension;b.validation.Rule=function(a){b.extend(this,a)};b.defineType(b.validation.Rule,{validate:function(a,c,d){return!this.isValid(a,
c,d)?new b.validation.Error(this,c,this.formatError(a,c,d)):null},isValid:function(){return!0},formatError:function(a,b,d){var e=this;return this.message.replace(/\{\{|\}\}|\{(\w+(\.\w+)*)\}/gi,function(a,g){if("{{"===a)return"{";if("}}"===a)return"}";var h=g.split(".");if(1===h.length){if("value"===h[0])return d}else{if("property"===h[0]){var i=b.metaData[h[1]];return i.isPropertyAccessor?b.metaData[h[1]]():i}if("rule"===h[0])return e[h[1]]}return""})}});b.validation.rules={};b.validation.Error=
function(a,b,d){this.rule_=a;this.property_=b;this.message_=d};b.defineType(b.validation.Error,{getProperty:function(){return this.property_},getMessage:function(){return this.message_},getRule:function(){return this.rule_}});b.validation.defineRule=function(a,c){var d=b.validation.rules[a]=function(a){d.base(this,a)};b.defineType(d,b.validation.Rule,c)};b.validation.defineRule("length",{isValid:function(a,b,d){return d.length>=this.minLength&&d.length<=this.maxLength},message:"'{property.displayName}' must be between {rule.minLength} and {rule.maxLength} characters in length.",
minLength:0,maxLength:Number.MAX_VALUE});b.validation.defineRule("required",{isValid:function(a,c,d){return!b.isNullOrUndefined(d)&&""!==d},message:"'{property.displayName}' must have a value."});b.validation.defineRule("regex",{isValid:function(a,b,d){return d&&null!==d.match(this.regex)},regex:void 0,message:"'{property.displayName}' does not match the expected input format."});b.validation.defineRule("number",{isValid:function(a,b,d){return!isNaN(Number(d))},message:"'{property.displayName}' must be a number."});
b.validation.defineRule("in",{isValid:function(a,c,d){return-1!==b.array.indexOf(this.values,d)},values:[],message:"'{property.displayName}' must be one of the following values {rule.values}."})})})(window);
